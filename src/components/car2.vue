<template>
<div id="car2">
  <div class="container">
      <div class="h3" style="text-align:center; margin-top:80px; margin-bottom:20px;]">Model Predictive Control in Autonomous Driving (231A)
      </div>
      <div class="h5" style="text-align:center;">
        {{msg}}
      </div>
    <div class="row">
      <div class="col-md-6">
        <div class="threescene border border-primary" v-bind:style="{ width: width+'px', height: height+ 'px' }" id="threetruck"></div>
        <br>positionx: {{positionx}}
        <br>positiony: {{positiony}}
        <br>theta: {{theta}}
      </div>
      <div class="col-md-6">
        <div class="threescene border border-primary" v-bind:style="{ width: width+'px', height: height+ 'px' }" id="threetruck2"></div>
      </div>
    </div>
  </div>
  <br><br><br>
</div>
</template>

<script>
import * as THREEJS from 'three'
import * as THREE_ADDONS from 'three-addons'
const THREE = {...THREEJS, ...THREE_ADDONS}
export default {
  name: 'car2',
  data () {
    return {
      height: 450,
      width: 550,
      positionXA: [249.521262, 248.805507, 247.893841, 246.799910, 245.544135, 244.145959, 242.628255, 241.015279,
        239.332854, 237.607119, 236.039674, 234.444529, 232.847406, 231.249317, 229.651611, 228.053553,
        226.455466, 224.989581, 223.451217, 221.908443, 220.364332, 218.818929, 217.275280, 215.730814,
        214.292000, 212.791335, 211.288465, 209.789059, 208.283299, 206.811523, 205.320825, 203.836696,
        202.348892, 200.859793, 199.370250, 197.834507, 196.322458, 194.813607, 193.306638, 191.797717,
        190.289368, 188.780889, 187.272343, 185.763809, 184.255401, 182.746849, 181.239965, 179.731133,
        178.220804, 176.713884, 175.206939, 173.700412, 172.195361, 170.686341, 169.179216, 167.670516,
        166.157186, 164.642410, 163.132365, 161.622445, 160.111273, 158.602071, 157.092056, 155.623524,
        154.136502, 152.642277, 151.152067, 149.657808, 148.163905, 146.670951, 144.989829, 143.401960,
        141.822037, 140.241395, 138.659489, 137.079966, 135.349589, 133.684840, 132.032655, 130.380449,
        128.724965, 127.071440, 125.383738, 123.716434, 122.047387, 120.380100, 118.712656, 117.045227,
        115.377858, 113.687353, 112.008481, 110.332595, 108.655247, 106.978813, 105.295912, 103.617302,
        101.939316, 100.260681, 98.582469, 96.904233, 95.225733, 93.553073, 91.877173, 90.201493,
        88.525839, 86.848711, 85.156235, 83.471335, 81.787472, 80.104691, 78.420738, 76.738104,
        75.096208, 73.430842, 71.763484, 70.096298, 68.429129, 66.761544, 65.094562, 63.428443,
        61.761342, 60.094195, 58.427040, 56.759896, 55.092740, 53.425556, 51.758371, 50.091170,
        48.552220, 47.136621, 45.740924, 44.262501, 43.036359, 42.000209, 41.152309, 40.506337,
        40.072879, 39.859188, 39.868415, 39.618583, 39.350669, 39.463200, 39.354047, 39.243083,
        39.514387, 39.581205, 39.631011, 39.679880, 39.727166, 39.774261, 39.821475, 39.945397,
        40.025746, 40.115611, 40.203796, 40.287541, 40.370004, 40.452380, 40.104017, 39.989007,
        39.884215, 39.782429, 39.685104, 39.586039, 39.023350, 38.463369, 38.054062, 37.653629,
        37.081038, 36.603736, 36.134452, 35.666196, 35.201463, 34.731563, 34.265945, 33.506988,
        32.904792, 32.313297, 31.726874, 31.135312, 30.549077, 29.953239, 29.495669, 28.959944,
        28.423889, 27.895781, 27.364016, 26.829383, 26.297462, 25.759056, 25.259642, 24.741678,
        24.226164, 23.718264, 23.207626, 22.529162, 21.945026, 21.367087, 20.790008, 20.213137,
        19.640152, 19.060505, 18.597961, 18.068856, 17.540029, 17.021991, 16.490012, 15.965475,
        15.342217, 14.770808, 14.198326, 13.637626, 13.069550, 12.502610, 11.939141, 11.366015,
        10.733721, 10.130518, 9.532824, 8.935731, 8.342129, 7.740496, 7.145049, 6.770463,
        6.269468, 5.764945, 5.263026, 4.763416, 4.305785, 3.835608, 3.359056, 2.879282,
        2.402179, 1.915614, 1.437313, 1.437313],

      positionYA: [248.331418, 246.741374, 245.255072, 243.897086, 242.687855, 241.646850, 240.789984, 240.130388,
        239.677570, 239.438934, 238.769786, 238.179709, 237.595113, 237.013158, 236.430171, 235.848146,
        235.266202, 234.366325, 233.640875, 232.925045, 232.212114, 231.502247, 230.788421, 230.076263,
        229.152202, 228.351829, 227.555634, 226.753166, 225.962537, 225.109015, 224.290241, 223.459752,
        222.635800, 221.814137, 220.993282, 220.258763, 219.480166, 218.695366, 217.907185, 217.122596,
        216.336831, 215.551315, 214.765929, 213.980520, 213.194866, 212.409491, 211.621150, 210.836294,
        210.054556, 209.266137, 208.477910, 207.688640, 206.896779, 206.112506, 205.324458, 204.539349,
        203.763393, 202.990277, 202.207787, 201.425041, 200.644944, 199.860895, 199.078334, 198.217881,
        197.392513, 196.580423, 195.760967, 194.948711, 194.135809, 193.321177, 192.910649, 192.301185,
        191.671571, 191.043766, 190.419443, 189.788825, 189.627143, 189.274531, 188.871007, 188.467551,
        188.078072, 187.680078, 187.437955, 187.102322, 186.775774, 186.440058, 186.105135, 185.770139,
        185.434842, 185.224941, 184.953032, 184.663903, 184.383284, 184.096737, 183.849629, 183.576370,
        183.300272, 183.027534, 182.752770, 182.476916, 182.202718, 181.894446, 181.605388, 181.314409,
        181.023312, 180.741517, 180.557041, 180.325487, 180.087178, 179.840611, 179.602970, 179.355362,
        178.880444, 178.535405, 178.200054, 177.863845, 177.527557, 177.193855, 176.856817, 176.516270,
        176.179644, 175.843242, 175.506880, 175.170469, 174.834119, 174.497902, 174.161693, 173.825562,
        173.017882, 171.998961, 171.002266, 170.161492, 168.935620, 167.532527, 166.008126, 164.387792,
        162.698154, 160.966915, 159.222614, 157.540275, 155.860845, 154.139650, 152.442513, 150.745481,
        149.042532, 147.342975, 145.642947, 143.942900, 142.242809, 140.542714, 138.842622, 137.145634,
        135.446775, 133.748476, 132.050022, 130.351335, 128.652588, 126.953836, 125.259038, 123.562157,
        121.864635, 120.166936, 118.469082, 116.771368, 115.131374, 113.512844, 111.862067, 110.209132,
        108.601987, 106.969577, 105.334855, 103.699839, 102.063923, 100.429416, 98.793758, 97.255393,
        95.664848, 94.070311, 92.473972, 90.879457, 89.283052, 87.690183, 86.048998, 84.434815,
        82.820745, 81.204154, 79.588699, 77.974167, 76.358849, 74.745611, 73.119688, 71.499723,
        69.878977, 68.255926, 66.633783, 65.069132, 63.472035, 61.872493, 60.272642, 58.672717,
        57.071505, 55.472619, 53.833768, 52.217406, 50.600955, 48.981104, 47.365790, 45.747943,
        44.163692, 42.561943, 40.960531, 39.354967, 37.751936, 36.148464, 34.543878, 32.942699,
        31.363073, 29.772903, 28.180639, 26.588150, 24.994467, 23.403783, 21.810677, 20.143188,
        18.517878, 16.893678, 15.268670, 13.642952, 12.004675, 10.370259, 8.737662, 7.105987,
        5.473641, 3.844068, 2.211955, 2.211955],

      thetaA: [4.575384, 4.447881, 4.320481, 4.192891, 4.065820, 3.938948, 3.812375, 3.686080,
        3.560145, 3.434359, 3.492620, 3.495250, 3.496205, 3.496169, 3.496474, 3.496401,
        3.496324, 3.575356, 3.577704, 3.579063, 3.579209, 3.564652, 3.579871, 3.579557,
        3.631404, 3.632985, 3.633420, 3.636453, 3.620575, 3.633901, 3.635460, 3.652155,
        3.638890, 3.639443, 3.639600, 3.634220, 3.616596, 3.616305, 3.630924, 3.615831,
        3.616062, 3.616151, 3.616174, 3.616191, 3.616284, 3.616249, 3.630980, 3.629379,
        3.613538, 3.628735, 3.614873, 3.616317, 3.631965, 3.617382, 3.631074, 3.629504,
        3.613380, 3.610771, 3.625353, 3.625285, 3.610670, 3.625840, 3.625558, 3.628878,
        3.646659, 3.631977, 3.648793, 3.647349, 3.646583, 3.646582, 3.515384, 3.530482,
        3.528909, 3.527487, 3.511715, 3.513320, 3.381350, 3.390077, 3.388911, 3.388000,
        3.371779, 3.371990, 3.353012, 3.351204, 3.334341, 3.334571, 3.334523, 3.334490,
        3.334549, 3.322757, 3.304642, 3.319538, 3.304717, 3.304939, 3.295746, 3.309941,
        3.307496, 3.294378, 3.294871, 3.296433, 3.297050, 3.318044, 3.303904, 3.305462,
        3.306469, 3.304513, 3.298246, 3.280197, 3.280061, 3.280642, 3.278452, 3.279879,
        3.349519, 3.346731, 3.346265, 3.346160, 3.346108, 3.331533, 3.346520, 3.346128,
        3.346159, 3.346129, 3.346099, 3.346099, 3.346091, 3.346050, 3.346025, 3.345993,
        3.478092, 3.606111, 3.644859, 3.646810, 3.788781, 3.916854, 4.045077, 4.173310,
        4.301542, 4.429804, 4.558007, 4.541124, 4.556087, 4.652724, 4.635172, 4.651805,
        4.742816, 4.731829, 4.733467, 4.734299, 4.734482, 4.734556, 4.734629, 4.749412,
        4.751069, 4.766067, 4.754364, 4.755058, 4.755219, 4.755302, 4.646030, 4.648907,
        4.647597, 4.647415, 4.662325, 4.661974, 4.519978, 4.487554, 4.470097, 4.469801,
        4.446312, 4.428597, 4.428169, 4.428127, 4.442892, 4.427575, 4.440609, 4.356601,
        4.367671, 4.352331, 4.367275, 4.352073, 4.367332, 4.350369, 4.379868, 4.381766,
        4.383446, 4.398459, 4.385597, 4.386187, 4.401182, 4.385693, 4.392959, 4.394606,
        4.396237, 4.411427, 4.412699, 4.360467, 4.361484, 4.360809, 4.360807, 4.360855,
        4.375783, 4.360203, 4.384661, 4.386473, 4.388071, 4.405908, 4.389443, 4.390926,
        4.385029, 4.382285, 4.365127, 4.381468, 4.366441, 4.366697, 4.381661, 4.364628,
        4.365752, 4.348528, 4.348295, 4.348286, 4.363062, 4.348005, 4.348479, 4.399517,
        4.401486, 4.403077, 4.404675, 4.406210, 4.415157, 4.432169, 4.419306, 4.419934,
        4.435076, 4.418133, 4.419527, 4.419527],
      msg: '3D model is loading...',
      render: '',
      uuid: '',
      obj: '',
      index: '',
      positionx: '',
      positiony: '',
      theta: ''
    }
  },
  mounted () {
    this.$nextTick(function () {
      this.foo()
    })
  },
  methods: {
    foo () {
      var scene = new THREE.Scene()
      var frustumSize = 2450
      var aspect = this.width / this.height
      // var camera = new THREE.PerspectiveCamera(450, window.innerWidth / window.innerHeight, 0.1, 10000)
      var camera = new THREE.OrthographicCamera(frustumSize * aspect / -2, frustumSize * aspect / 2, frustumSize / 2, frustumSize / -2, -1000, 100000)
      scene.add(camera)
      camera.position.z = 500
      camera.position.y = 300
      camera.position.x = 500
      var renderer = new THREE.WebGLRenderer({antialias: true})
      renderer.setPixelRatio(window.devicePixelRatio)
      renderer.setSize(this.width - 2, this.height - 2)
      document.getElementById('threetruck').appendChild(renderer.domElement)
      scene.background = new THREE.Color().setHSL(1, 1, 1)
      renderer.render(scene, camera)
      var gridHelper = new THREE.GridHelper(10000, 30, 0x0000ff, 0x808080)
      // gridHelper.scale.set(1.3, 1, 11)
      gridHelper.position.y = 0
      gridHelper.position.x = 0
      gridHelper.position.z = 0
      scene.add(gridHelper)
      // objectLoader
      var objectLoader = new THREE.ObjectLoader()
      objectLoader.load('../static/car2.json', (obj) => {
        this.uuid = obj.uuid
        scene.add(obj)
        console.log(scene)
        this.msg = ''
        animate()
      })
      var geometry = new THREE.CylinderBufferGeometry(70, 70, 200, 32)
      var material = new THREE.MeshPhongMaterial({color: 0xff0000})
      var cylinder = new THREE.Mesh(geometry, material)
      cylinder.position.z = -1650
      cylinder.position.y = 100
      scene.add(cylinder)
      var controls = new THREE.OrbitControls(camera, document.getElementById('threetruck'))
      controls.enableZoom = true
      controls.zoomSpeed = 1.0
      controls.update()
      var light = new THREE.AmbientLight(0x255f7c)
      scene.add(light)
      var i = 0
      var animate = () => {
        i += 1
        this.index = Math.floor(i / 4)
        requestAnimationFrame(animate)
        if (this.index === this.thetaA.length) {
          i = 0
        }
        scene.children[4].rotation.y = this.thetaA[this.index]
        scene.children[4].position.z = this.positionXA[this.index] * 10
        scene.children[4].position.x = this.positionYA[this.index] * 10
        this.positionx = this.positionXA[this.index]
        this.positiony = this.positionYA[this.index]
        this.theta = this.thetaA[this.index]
        camera.position.z = this.positionXA[this.index] * 10
        camera.position.x = this.positionYA[this.index] * 10
        camera.lookAt(new THREE.Vector3(scene.children[4].position.x, scene.children[4].position.y, scene.children[4].position.z))
        // controls.update()
        renderer.render(scene, camera)
      }
    }
  }
}
</script>
<style scoped>
</style>
